#!/usr/bin/env php
<?php

require __DIR__.'/../vendor/autoload.php';

use AkeneoEtl\Application\ActionFactory;
use AkeneoEtl\Infrastructure\Command;
use AkeneoEtl\Infrastructure\ConnectionProfile\ProfileFactory as ConnectionProfileFactory;
use AkeneoEtl\Infrastructure\EtlFactory;
use AkeneoEtl\Infrastructure\EtlProfile\ProfileFactory as EtlProfileFactory;
use Symfony\Component\Console\Application;
use Symfony\Component\Validator\ValidatorBuilder;

$stepFactory = new ActionFactory();
$validatorBuilder = new ValidatorBuilder();

$etlFactory = new EtlFactory();
$connectionProfileFactory = new ConnectionProfileFactory();
$etlProfileFactory = new EtlProfileFactory($stepFactory, $validatorBuilder->getValidator());

$application = new Application('AkeneoEtl', 'git_version');
$application->add(new Command\TransformCommand($etlFactory, $connectionProfileFactory, $etlProfileFactory));
$application->run();
